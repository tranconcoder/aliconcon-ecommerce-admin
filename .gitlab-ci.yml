include:
  - project: tvconss/gitlab-tools
    ref: main
    file: sync-to-github/.gitlab-ci.yml

stages:
  - sync-to-github
  - build_and_deploy

variables:
  GITHUB_REPO: "aliconcon-ecommerce-admin"

deploy_client_admin:
  stage: build_and_deploy
  image: docker:latest
  variables:
    DOCKER_HOST: unix:///var/run/docker.sock
    CONTAINER_NAME: "aliconcon-client-admin"
    IMAGE_NAME: "aliconcon-client-admin"
    APP_PORT: 3008
  before_script:
    - docker info

  script:
    # Build and Run using Docker Compose
    - echo "üèóÔ∏è Building and deploying with Docker Compose..."
    - docker compose build --build-arg REACT_APP_API_URL=$REACT_APP_API_URL
    - docker compose up -d

    - echo "‚úÖ Deployment Complete!"

  only:
    - master

  tags:
    - docker